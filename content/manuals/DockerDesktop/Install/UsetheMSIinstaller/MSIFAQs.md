+++
title = "MSI 常见问题解答"
date = 2024-10-23T14:54:40+08:00
weight = 10
type = "docs"
description = ""
isCJKLanguage = true
draft = false

+++

> 原文：[https://docs.docker.com/desktop/install/msi/faq/](https://docs.docker.com/desktop/install/msi/faq/)
>
> 收录该文档的时间：`2024-10-23T14:54:40+08:00`

# MSI FAQs - MSI 常见问题解答

### 如果用户已有旧版本的 Docker Desktop（即 `.exe`），其用户数据会如何处理？ What happens to user data if they have an older Docker Desktop installation (i.e. `.exe`)?

If they have an older `.exe` installation, users must [uninstall]({{< ref "/manuals/DockerDesktop/Uninstall" >}}) this version before using the new MSI version. This deletes all Docker containers, images, volumes, and other Docker-related data local to the machine, and removes the files generated by the application. For older versions, users should [backup]({{< ref "/manuals/DockerDesktop/HowtobackupandrestoreyourDockerDesktopdata" >}}) any containers that they want to keep.

​	如果用户已有旧的 `.exe` 安装，需在使用新的 MSI 版本前[卸载]({{< ref "/manuals/DockerDesktop/Uninstall" >}})该版本。这将删除机器上的所有 Docker 容器、镜像、卷及其他与 Docker 相关的本地数据，并移除应用程序生成的文件。对于旧版本，用户应[备份]({{< ref "/manuals/DockerDesktop/HowtobackupandrestoreyourDockerDesktopdata" >}})想要保留的容器数据。

For Docker Desktop versions 4.30 and later of the `exe` installer, a `-keep-data` flag is available. It removes Docker Desktop but keeps underlying data, such as the VMs that run containers.

​	对于 4.30 及以上版本的 `.exe` 安装程序，可以使用 `-keep-data` 标志。此命令会移除 Docker Desktop，但保留基础数据，如运行容器的虚拟机（VM）。



```powershell
& 'C:\Program Files\Docker\Docker\Docker Desktop Installer.exe' uninstall -keep-data
```

### 如果用户的机器已有旧的 `.exe` 安装，会发生什么？What happens if the user's machine has an older `.exe` installation?

The new MSI installer checks if a previous version was installed and doesn't proceed with the installation. Instead, it prompts the user to uninstall their current/old version first, before retrying to install the MSI version.

​	新的 MSI 安装程序会检查是否存在旧版本并停止安装，提示用户先卸载当前/旧版本，然后重新尝试安装 MSI 版本。

### 我的安装失败了，如何查找原因？My installation failed, how do I find out what happened?

MSI installations can sometimes fail unexpectedly and not provide users with much information about what went wrong.

​	MSI 安装有时会意外失败，且不会向用户提供出错的详细信息。

To debug a failed installation, run the install again with verbose logging enabled:

​	要调试失败的安装，请再次运行安装并启用详细日志：



```powershell
msiexec /i "DockerDesktop.msi" /L*V ".\msi.log"
```

After the installation has failed, open the log file and search for occurrences of `value 3`. This is the exit code Windows Installer outputs when it has failed. Just above the line, you will find the reason for the failure.

​	安装失败后，打开日志文件并搜索 `value 3`。这是 Windows Installer 出现失败时的退出代码。在该行上方会找到失败的原因。

### 为什么安装程序在每次全新安装结束时都会提示重启？Why does the installer prompt for a reboot at the end of every fresh installation?

The installer prompts for a reboot because it assumes that changes have been made to the system that require a reboot to finish their configuration.

​	安装程序提示重启是因为假定对系统进行了需要重启以完成配置的更改。

For example, if you select the WSL engine, the installer adds the required Windows features. After these features are installed, the system reboots to complete configurations so the WSL engine is functional.

​	例如，如果选择 WSL 引擎，安装程序会添加所需的 Windows 功能。安装这些功能后，系统会重启以完成配置，使 WSL 引擎正常工作。

You can suppress reboots by using the `/norestart` option when launching the installer from the command line:

​	您可以在命令行启动安装程序时使用 `/norestart` 选项来抑制重启：



```powershell
msiexec /i "DockerDesktop.msi" /L*V ".\msi.log" /norestart
```

### 为什么 MSI 安装时，`docker-users` 组在通过 Intune 或其他 MDM 解决方案安装后未填充？Why isn't the `docker-users` group populated when the MSI is installed with Intune or another MDM solution?

It's common for MDM solutions to install applications in the context of the system account. This means that the `docker-users` group isn't populated with the user's account, as the system account doesn't have access to the user's context.

​	MDM 解决方案通常会在系统帐户上下文中安装应用程序。这意味着 `docker-users` 组未填充用户帐户，因为系统帐户无法访问用户上下文。

As an example, you can reproduce this by running the installer with `psexec` in an elevated command prompt:

​	例如，可以通过在提升的命令提示符下使用 `psexec` 运行安装程序来重现此现象：



```powershell
psexec -i -s msiexec /i "DockerDesktop.msi"
```

The installation should complete successfully, but the `docker-users` group won't be populated.

​	安装应成功完成，但 `docker-users` 组不会被填充。

As a workaround, you can create a script that runs in the context of the user account.

​	解决方法是创建一个在用户帐户上下文中运行的脚本。

The script would be responsible for creating the `docker-users` group and populating it with the correct user.

​	该脚本将负责创建 `docker-users` 组并将正确的用户添加到该组中。

Here's an example script that creates the `docker-users` group and adds the current user to it (requirements may vary depending on environment):

​	以下是创建 `docker-users` 组并将当前用户添加到该组的示例脚本（根据环境的不同可能有所不同）：



```powershell
$Group = "docker-users"
$CurrentUser = [System.Security.Principal.WindowsIdentity]::GetCurrent().Name

# Create the group
New-LocalGroup -Name $Group

# Add the user to the group
Add-LocalGroupMember -Group $Group -Member $CurrentUser
```

> **Note**
>
> 
>
> After adding a new user to the `docker-users` group, the user must sign out and then sign back in for the changes to take effect.
>
> ​	将新用户添加到 `docker-users` 组后，用户必须注销并重新登录以使更改生效。
